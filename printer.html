<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>KYS → Web → Zebra | Toplu Baskı (Mock’lu)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--gap:12px}
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;max-width:1000px;margin:24px auto;padding:0 12px;line-height:1.5;background:#fafafa}
    h1{font-size:22px;margin-bottom:8px}
    .row{display:flex;gap:var(--gap);align-items:center;flex-wrap:wrap;margin:8px 0}
    .col{display:flex;flex-direction:column;gap:8px}
    fieldset{border:1px solid #ddd;border-radius:10px;padding:12px;margin-bottom:16px}
    label{font-weight:600}
    select,input[type=file],input[type=text],button,textarea{padding:8px;font-size:14px;border:1px solid #ccc;border-radius:4px}
    button{background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer}
    button:hover{background:#0056b3}
    input:focus,select:focus,textarea:focus{outline:2px solid #007bff}
    textarea{width:100%;min-height:180px;font-family:ui-monospace,Menlo,Consolas,monospace}
    .log{background:#f6f6f6;border:1px solid #eee;border-radius:10px;padding:8px;height:200px;overflow:auto;font-family:ui-monospace,Menlo,Consolas,monospace}
    .ok{color:#186a3b}.err{color:#922b21}.muted{color:#777}
    table{border-collapse:collapse;width:100%;font-size:13px}
    th,td{border:1px solid #eee;padding:6px}
    th{background:#fafafa}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef;border:1px solid #dde}
    .warn{background:#fff4e5;border-color:#ffe0b2}
    .success{background:#e8f5e9;border-color:#c8e6c9}
    .danger{background:#ffebee;border-color:#ffcdd2}
  </style>
  <script src="BrowserPrint-3.1.250.min.js"></script>
</head>
<body>
  <h1>KYS → Web → Zebra | Toplu Baskı (Mock KYS ile geliştirme)</h1>
  <p class="muted">USB ile bağlı Zebra ZD220T/GT800 için; KYS API henüz hazır değilken <b>mock</b> veriyle geliştirme yapar. API hazır olduğunda gerçek endpoint’i ayarlayıp aynı sayfayla devam edebilirsiniz.</p>

  <fieldset>
    <legend>1) Veri Kaynağı</legend>
    <div class="row">
      <label><input type="radio" name="source" value="mock" checked> Mock KYS (yerleşik örnek veriler)</label>
      <label><input type="radio" name="source" value="api"> Gerçek API (hazır olunca)</label>
      <label><input type="radio" name="source" value="csv"> CSV Yükle</label>
    </div>
    <div class="row" id="apiRow" style="display:none">
      <label for="apiUrl">API URL:</label>
      <input id="apiUrl" type="text" size="60" placeholder="https://kys.ornek.org/api/print-data?event_id=123" />
      <button id="btnFetch">Verileri Getir</button>
    </div>
    <div class="row" id="csvRow" style="display:none">
      <label for="csvFile">CSV:</label>
      <input id="csvFile" type="file" accept=".csv" />
    </div>
    <div class="row">
      <span class="pill warn">Beklenen alanlar: <code>name, title, qr_payload</code></span>
      <button id="btnLoadMock">Mock Veriyi Yükle</button>
      <button id="btnPreview">İlk 5 Satırı Önizle</button>
    </div>
    <div id="preview"></div>
  </fieldset>

  <fieldset>
    <legend>2) ZPL Şablon</legend>
    <div class="col">
      <textarea id="zpl">^XA
^PW800
^CI28
^LH20,20
^A0N,40,40
^FO20,20^FD${name}^FS
^A0N,28,28
^FO20,70^FD${title}^FS
^FO20,120^BQ,2,10
^FDQA,${qr_payload}^FS
^XZ</textarea>
      <small class="muted">Notlar: <code>^CI28</code> UTF-8, <code>^PW</code> genişlik, <code>^FOx,y</code> konum, <code>^A0N,h,w</code> font/ebat, <code>^BQ</code> QR.</small>
    </div>
  </fieldset>

  <fieldset>
    <legend>3) Yazıcı Seçimi</legend>
    <div class="row">
      <button id="btnFind">Yazıcıları Bul</button>
      <select id="printers" style="min-width:260px"></select>
      <button id="btnTest">Test Baskı</button>
      <span class="muted">(Browser Print Agent kurulu ve açık olmalı)</span>
    </div>
  </fieldset>

  <fieldset>
    <legend>4) Toplu Baskı</legend>
    <div class="row">
      <label>Gecikme (ms): <input id="delayMs" type="text" value="100" size="6"></label>
      <button id="btnPrint">Toplu Bas</button>
      <button id="btnStop">Durdur</button>
      <progress id="prog" value="0" max="100" style="width:220px"></progress>
      <span id="status" class="muted"></span>
    </div>
    <div class="row">
      <div class="col" style="flex:1">
        <label>Günlük</label>
        <div id="log" class="log"></div>
      </div>
    </div>
  </fieldset>

<script src="printer.js"></script>
</body>
</html>
